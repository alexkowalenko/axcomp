MODULE PrimeNumbers;  (*NW 6.9.07; Tabulate prime numbers; for Oberon-07  NW 25.1.2013*)

VAR n: INTEGER;
    p: ARRAY 400 OF INTEGER;
    v: ARRAY 20 OF INTEGER;

PROCEDURE Primes(n: INTEGER);
    VAR i, k, m, x, inc, lim, sqr: INTEGER; prim: BOOLEAN;

BEGIN x := 1; inc := 4; lim := 1; sqr := 4; m := 0; i := 3;
    WHILE i <= n DO
      REPEAT x := x + inc; inc := 6 - inc;
        IF sqr <= x THEN  (*sqr = p[lim]^2*)
          v[lim] := sqr; lim := lim + 1; sqr := p[lim]*p[lim]
        END ;
        k := 2; prim := TRUE;
        WHILE prim & (k < lim) DO
          k := k+1;
          IF v[k] < x THEN v[k] := v[k] + p[k] END ;
          prim := x # v[k]
        END
      UNTIL prim;
      p[i] := x; WriteInt(x);
      IF m = 10 THEN 
        WriteLn; 
        m := 0 
      ELSE 
        m := m+1 
      END;
      i := i+1
    END ;
    IF m > 0 THEN WriteLn() END
END Primes;

BEGIN 
    n := 283; (*ReadInt(n); *) 
    WriteInt(n); WriteLn; 
    Primes(n)
END PrimeNumbers.


(*
RUN: %comp %s | filecheck %s
CHECK: 283
CHECK-NEXT:       57111317192329313741
CHECK-NEXT:       4347535961677173798389
CHECK-NEXT:       97101103107109113127131137139149
CHECK-NEXT:       151157163167173179181191193197199
CHECK-NEXT:       211223227229233239241251257263269
CHECK-NEXT:       271277281283293307311313317331337
CHECK-NEXT:       347349353359367373379383389397401
CHECK-NEXT:       409419421431433439443449457461463
CHECK-NEXT:       467479487491499503509521523541547
CHECK-NEXT:       557563569571577587593599601607613
CHECK-NEXT:       617619631641643647653659661673677
CHECK-NEXT:       683691701709719727733739743751757
CHECK-NEXT:       761769773787797809811821823827829
CHECK-NEXT:       839853857859863877881883887907911
CHECK-NEXT:       919929937941947953967971977983991
CHECK-NEXT:       9971009101310191021103110331039104910511061
CHECK-NEXT:       10631069108710911093109711031109111711231129
CHECK-NEXT:       11511153116311711181118711931201121312171223
CHECK-NEXT:       12291231123712491259127712791283128912911297
CHECK-NEXT:       13011303130713191321132713611367137313811399
CHECK-NEXT:       14091423142714291433143914471451145314591471
CHECK-NEXT:       14811483148714891493149915111523153115431549
CHECK-NEXT:       15531559156715711579158315971601160716091613
CHECK-NEXT:       16191621162716371657166316671669169316971699
CHECK-NEXT:       17091721172317331741174717531759177717831787
CHECK-NEXT:       178918011811182318311847
CHECK-NEXT: 0
*)
